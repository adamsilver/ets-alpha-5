{% extends "layout.html" %}
{% set installation = '' %}
{% for item in data['installations'] %}
  {% if installationID == item.permitId %}
	{% set installation = item.name %}
  {% endif %}
{% endfor %}
{% block content %}
<div class="govuk-grid-row">
	<div class="govuk-grid-column-three-quarters">
		<h1 class="govuk-heading-xl">{{ installation }} </h1>
    <p>Permit ID: {{ installationID }}</p>
	</div>
	<div class="govuk-grid-column-one-quarter">
		<aside class="app-related-items" role="complementary">
			<h2 class="govuk-heading-s" id="subsection-title">
				Tasks
			</h2>
			<nav role="navigation" aria-labelledby="subsection-title">
				<ul class="govuk-list govuk-!-font-size-16">
					<li><a href="/transaction-history-transfer">View installation history</a></li>
					<li><a href="/transfer-allowance/2fa">Transfer more allowance</a></li>
          <li><a href="/surrender-allowance/2fa">Surrender more allowance</a></li>
          <li><a href="/submit-emissions/2fa">Submit emissions</a></li>
				</ul>
			</nav>
		</aside>
	</div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    {% if data['ets-transfer-allowance'] and data['ets-transfer-allowance']['installation'] == installation %} 
      <h2 class="govuk-heading-l">Recent transfers</h2>
      <table class="govuk-table">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th class="govuk-table__header app-width-2" scope="col">Date</th>
            <th class="govuk-table__header app-width-1" scope="col">Reference</th>
            <th class="govuk-table__header " scope="col">Units</th>
            <th class="govuk-table__header " scope="col">Recipient</th>
            <th class="govuk-table__header govuk-table__header app-width-3" scope="col">Status</th>
          </tr>
        </thead>
        <tbody class="govuk-table__body">
          <tr class="govuk-table__row">
            <th class="govuk-table__header" scope="row">
            {{ currentDate | date("DD MMMM YYYY") }}<br/>
            {{ currentDate | date("h:mm:ss a") }}
            </th>
            <td class="govuk-table__cell">
              BGT8723X
            </td>
            <td class="govuk-table__cell">
              {% for emission, value, object in data['emissionAllowance'] %}
                {{ (emission).split('-').join(" ") }}: <strong>{{ value.moved }}</strong> <br />
              {% endfor %}
            </td>
            <td class="govuk-table__cell">
            {% if data['ets-transfer-allowance']['recipient'] %}
              {{ data['ets-transfer-allowance']['recipient'] }}
            {% else %}
              Polimeri Europa UK Limited
            {% endif %}
            </td>
            <td class="govuk-table__cell">
            {{ govukTag({
              text: "awaiting approval"
            }) }}
            </td>
          </tr>
        </tbody>
      </table>
    {% endif %}
    {% if data['ets-surrender-allowance'] and data['ets-surrender-allowance']['installation'] == installation %}
    <h2 class="govuk-heading-l">Recent surrenders</h2>
      <table class="govuk-table">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th class="govuk-table__header app-width-2" scope="col">Date</th>
            <th class="govuk-table__header app-width-1" scope="col">Reference</th>
            <th class="govuk-table__header " scope="col">Units</th>
            <th class="govuk-table__header " scope="col">Dynamic compliance status</th>
            <th class="govuk-table__header govuk-table__header app-width-3" scope="col">Status</th>
          </tr>
        </thead>
        <tbody class="govuk-table__body">
          <tr class="govuk-table__row">
            <th class="govuk-table__header" scope="row">
            {{ currentDate | date("DD MMMM YYYY") }}<br/>
            {{ currentDate | date("h:mm:ss a") }}
            </th>
            <td class="govuk-table__cell">
              HDJ2123F
            </td>
            <td class="govuk-table__cell">
              {% if data['ets-surrender-allowance']['surrender-custom-amount'] != '' %}
                <strong>140</strong> units oversurrendered
              {% else %}
                {{ data['ets-surrender-allowance']['amount-to-surrender'] }}
              {% endif %}
            </td>
            <td class="govuk-table__cell">
              B
            </td>
            <td class="govuk-table__cell">
            {{ govukTag({
              text: "confirmed"
            }) }}
            </td>
          </tr>
        </tbody>
      </table>
    {% endif %}
    {% if data['ets-submit-emmissions'] and data['ets-submit-emmissions']['installation'] == installation %}
      <h2 class="govuk-heading-l">Recent submissions</h2>
      <table class="govuk-table">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th class="govuk-table__header app-width-2" scope="col">Date</th>
            <th class="govuk-table__header app-width-1" scope="col">Reference</th>
            <th class="govuk-table__header" scope="col">Units</th>
            <th class="govuk-table__header" scope="col">Verifier</th>
            <th class="govuk-table__header govuk-table__header app-width-3" scope="col">Status</th>
          </tr>
        </thead>
        <tbody class="govuk-table__body">
          <tr class="govuk-table__row">
            <th class="govuk-table__header" scope="row">
            {{ currentDate | date("DD MMMM YYYY") }}<br/>
            {{ currentDate | date("h:mm:ss a") }}
            </th>
            <td class="govuk-table__cell">
              BGT8723X
            </td>
            <td class="govuk-table__cell">
            {% for unit, value in data['ets-submit-emmissions']['emissions'] %}
            {% set unitName = unit %}
            {% if unit == 'co2' %}
              {% set unitName = 'Carbon dioxide (C0<sub>2</sub>)' %}
            {% elif unit == 'pfc' %}
              {% set unitName = 'Perfluorocarbons (PFCs)' %}
            {% else %}
              {% set unitName = 'Nitrous oxide (N<sub>2</sub>O)' %}
            {% endif %}
              {{ unitName | safe }}: <strong>{{ value}}</strong> <br />
            {% endfor %}
            </td>
            <td class="govuk-table__cell">
            {% if data['ets-submit-emmissions']['select-verifier'] == 'other' %}
              {{ data['ets-submit-emmissions']['verifier'] }}
            {% else %}
              {{ data['ets-submit-emmissions']['select-verifier'] }}
            {% endif %}
            </td>
            <td class="govuk-table__cell">
            {{ govukTag({
              text: "awaiting approval"
            }) }}
            </td>
          </tr>
        </tbody>
      </table>
    {% endif %}

    {% if not data['ets-transfer-allowance'] or not data['ets-surrender-allowance'] or not ['ets-submit-emmissions'] %}
     <p>No data just yet.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
